CR0.PG=1将开启内存页机制，由CR3保存内存页机制相关的数据结构体。

### 1 页表目录
页表目录用于索引页表，在页表目录中用于索引页表的信息被（此文）称为页表目录项。
```C
/*
 * +-----------+
 * |页表目录项0|
 * +-----------+
 * |页表目录项1|
 * +-----------+
 * |    ...    | */
```

页表目录项
```C
|31            12|11 9               0
+----------------+---+--+-+-+--+-+-+-+
|                |   |  | | |  |U|R| |
|页表地址[31..12]|AVL|00|D|A|00|/|/|P|
|                |   |  | | |  |S|W| |
+----------------+---+--+-+-+--+-+-+-+
```
页表地址：4Kb对齐，低12位由CPU自动补0；
D/A: 已修改/访问位，由硬件置位；
R/W: 1 - 可读写；0 - 仅可读或执行；
U/S: 特权级；
P: 1 - 页表可用；0 - 页表不可用。

### 2 页表
页表用于索引一块内存页，用于索引内存页的信息被（此文）成为页表项。
```C
+-------+
|页表项0|
+-------+
|页表项1|
+-------+
|  ...  |
```
页表项的位格式同页表目录项。

### 3 页机制所管理的内存大小
在32位地址下，1个页表目录大小为4Kb，可以索引128个页表；每个页表大小为4Kb可以描述128个内存页，每个内存页大小为4Kb；则1个页表目录最大可描述$2^7 * 2^7 * 2^12 = 64Mib$内存。

### 4 页映射
对于任意一个32位逻辑地址，可根据页机制映射到一个物理内存地址
```C
|31        22|21      12|11                 0|
+------------+----------+--------------------+
|页目录项索引|页表项索引|在内存页中的偏移地址|
+------------+----------+--------------------+
```
如 0x00000000 将用索引到页目录中的第1个（0）页目录项，根据该页目录项索引到对应的页表，在该页表中将索引到第1个（0）页表项，从该页表项中可得到内存页的物理地址mem，最后映射到的内存地址为mem（偏移为0）。

### 5 写时拷贝
页机制可以让多个不同逻辑地址指向同一内存页——在对应页表项中填写相同的内存页起始地址。

在创建进程时，不同进程可以拥有不同的逻辑地址空间，但共享父进程的物理内存页。当有进程要更改共享的物理内存页时，就在该进程的页表项中为其重新映射一块空闲的物理内存页，并将原物理内存页的数据拷贝到新物理内存页中，再实时更改操作。这就是页机制支持的写时拷贝。

### 5 linux0.11 物理内存划分
```C
+-------------+--------+------------+-------------+
| OS routines | BUFFER | [RAM-DISK] | MAIN_MEMORY |
+-------------+--------+------------+-------------+
0x0           end      4Mb                        16Mb
```
BUFFER: 用作硬盘、软盘等外设缓冲区;
RAM-DISK: 用作虚拟磁盘(若定义);
MAIN_MEMORY: 为剩余内存,将用作内核数据结构体的内存空间。
